<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Student Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <%- include('partials/navbar', { user }) %>

        <div class="dashboard-container">
            <div class="container">
                <h1 class="text-white mb-4">üëã Welcome, <%= user.fullname %>!</h1>

                <div class="row">
                    <!-- Attendance Overview -->
                    <div class="col-lg-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                üìä Attendance Overview
                            </div>
                            <div class="card-body">
                                <div class="attendance-progress mb-3">
                                    <div class="progress-bar" role="progressbar"
                                        style="width: <%= attendancePercentage %>%"
                                        aria-valuenow="<%= attendancePercentage %>" aria-valuemin="0"
                                        aria-valuemax="100">
                                        <%= attendancePercentage %>%
                                    </div>
                                </div>

                                <div class="row text-center mb-3">
                                    <div class="col-4">
                                        <h3 class="text-success">
                                            <%= presentDays %>
                                        </h3>
                                        <small class="text-muted">Present</small>
                                    </div>
                                    <div class="col-4">
                                        <h3 class="text-danger">
                                            <%= totalDays - presentDays %>
                                        </h3>
                                        <small class="text-muted">Absent</small>
                                    </div>
                                    <div class="col-4">
                                        <h3 class="text-primary">
                                            <%= totalDays %>
                                        </h3>
                                        <small class="text-muted">Total Days</small>
                                    </div>
                                </div>

                                <div class="chart-container">
                                    <canvas id="attendanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Exams -->
                    <div class="col-lg-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                üìÖ Upcoming Exams
                            </div>
                            <div class="card-body">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Mathematics - Unit Test</h6>
                                            <small class="text-muted">Jan 20, 2026</small>
                                        </div>
                                        <span class="badge bg-warning">3 days</span>
                                    </div>
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Physics - Final Exam</h6>
                                            <small class="text-muted">Jan 25, 2026</small>
                                        </div>
                                        <span class="badge bg-info">8 days</span>
                                    </div>
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Chemistry - Practical</h6>
                                            <small class="text-muted">Jan 28, 2026</small>
                                        </div>
                                        <span class="badge bg-primary">11 days</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Recent Marks -->
                    <div class="col-lg-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                üéØ Recent Results
                            </div>
                            <div class="card-body">
                                <% if (marks.length> 0) { %>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Subject</th>
                                                    <th>Marks</th>
                                                    <th>Grade</th>
                                                    <th>Date</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% marks.forEach(mark=> { %>
                                                    <tr>
                                                        <td>
                                                            <%= mark.subject %>
                                                        </td>
                                                        <td><strong>
                                                                <%= mark.marks %>/100
                                                            </strong></td>
                                                        <td>
                                                            <% if (mark.marks>= 90) { %>
                                                                <span class="badge bg-success">A+</span>
                                                                <% } else if (mark.marks>= 80) { %>
                                                                    <span class="badge bg-success">A</span>
                                                                    <% } else if (mark.marks>= 70) { %>
                                                                        <span class="badge bg-primary">B</span>
                                                                        <% } else if (mark.marks>= 60) { %>
                                                                            <span class="badge bg-warning">C</span>
                                                                            <% } else { %>
                                                                                <span class="badge bg-danger">D</span>
                                                                                <% } %>
                                                        </td>
                                                        <td><small>
                                                                <%= new Date(mark.date).toLocaleDateString() %>
                                                            </small></td>
                                                    </tr>
                                                    <% }); %>
                                            </tbody>
                                        </table>
                                    </div>
                                    <% } else { %>
                                        <p class="text-muted text-center py-4">No marks recorded yet.</p>
                                        <% } %>
                            </div>
                        </div>
                    </div>

                    <!-- Assignments -->
                    <div class="col-lg-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                üìù Assignments
                            </div>
                            <div class="card-body">
                                <% if (assignments.length> 0) { %>
                                    <div class="list-group list-group-flush">
                                        <% assignments.forEach(assignment=> { %>
                                            <div
                                                class="list-group-item d-flex justify-content-between align-items-start">
                                                <div class="flex-grow-1">
                                                    <h6 class="mb-1">
                                                        <%= assignment.title %>
                                                    </h6>
                                                    <small class="text-muted">Due: <%= new
                                                            Date(assignment.due_date).toLocaleDateString() %></small>
                                                </div>
                                                <% if (assignment.status==='submitted' ) { %>
                                                    <span class="badge badge-submitted">Submitted</span>
                                                    <% } else { %>
                                                        <span class="badge badge-pending">Pending</span>
                                                        <% } %>
                                            </div>
                                            <% }); %>
                                    </div>
                                    <% } else { %>
                                        <p class="text-muted text-center py-4">No assignments available.</p>
                                        <% } %>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Academic Materials -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                üìö Academic Materials
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <a href="#" class="text-decoration-none">
                                            <div class="stat-card text-center">
                                                <div class="stat-icon primary mx-auto">üìÑ</div>
                                                <h6>Mathematics Notes</h6>
                                                <small class="text-muted">PDF ‚Ä¢ 2.5 MB</small>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <a href="#" class="text-decoration-none">
                                            <div class="stat-card text-center">
                                                <div class="stat-icon success mx-auto">üìÑ</div>
                                                <h6>Physics Lectures</h6>
                                                <small class="text-muted">PDF ‚Ä¢ 3.1 MB</small>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <a href="#" class="text-decoration-none">
                                            <div class="stat-card text-center">
                                                <div class="stat-icon info mx-auto">üìÑ</div>
                                                <h6>Chemistry Lab Manual</h6>
                                                <small class="text-muted">PDF ‚Ä¢ 1.8 MB</small>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script src="/js/charts.js"></script>
        <script>
            // Initialize attendance chart
            initAttendanceChart(<%= presentDays %>, <%= totalDays - presentDays %>);
        </script>
</body>

</html>